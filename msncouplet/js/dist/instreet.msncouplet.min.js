/*!2013-07-10 */
(function(e){function t(){"undefined"!=typeof instreet_config&&p(instreet_config,c),(r=s())&&(d.importFile("css",c.cssurl),L.requestAd()),d.bind(e,"resize",function(){T.relocate()}),k(L.adsArray)}if(!e.InstreetWidget||"object"!=typeof e.InstreetWidget){e.InstreetWidget={version:"@REVISION@",type:"InstreetImageWidget",name:"msncouplet"};var i=e.document,n=(e.navigator,e.location),a=(n.hostname,!!e.ActiveXObject,[]),r=null,s=function(){var e=i.createElement("div"),t=i.getElementsByTagName("body")[0]||i.documentElement;return e.id=e.className="instreet-image-plugin-container",t&&t.firstChild?(t.insertBefore(e,t.firstChild),e):null},o={"746YRj7kfucKZSZc3KfGo0":980},l="http://push.instreet.cn/",c={redurl:l+"click.action",callbackurl:l+"push.action",murl:l+"tracker.action",iurl:l+"tracker90.action",ourl:l+"loadImage.action",surl:l+"share/weiboshare",cssurl:"css/instreet.msncouplet.css",imih:300,imiw:300,timer:1e3,width:120,height:600,adsLimit:1},d={bind:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},remove:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.datachEvent?e.datachEvent("on"+t,i):e["on"+t]=null},getEvent:function(t){return t?t:e.event},getTarget:function(e){return e.target||e.srcElement},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getRelatedTarget:function(e){return e.relatedTarget?e.relatedTarget:"mouseover"==e.type?e.fromElement:"mouseout"==e.type?e.toElement:null},getXY:function(e){var t=0,n=0;if(e.getBoundingClientRect){var a=e.getBoundingClientRect(),r=i.documentElement;t=a.left+Math.max(r.scrollLeft,i.body.scrollLeft)-r.clientLeft,n=a.top+Math.max(r.scrollTop,i.body.scrollTop)-r.clientTop}else for(;e!=i.body;t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent);return{x:t,y:n}},aTrim:function(e){function t(e,t){return e-t}var i=[];e.sort(t);for(var n=e.length,a=0,r=0;n>r;r++)e[r]!=e[r+1]&&(i[a]=e[r],a++);return i},$:function(e,t,n){var a,r=e||i;if(2==arguments.length?(n=t,a="*"):a=t||"*",i.getElementsByClassName)return r.getElementsByClassName(n);for(var s=[],o=r.getElementsByTagName(a),l=o.length,c=l;c--;){var d=o[c];if(d.className)for(var h=d.className.replace(/\s/g,"|").split("|"),u=h.length,f=u;f--;)if(h[f]==n){s.push(d);break}}return s},importFile:function(e,t){var n,a,r=i.getElementsByTagName("head")[0]||i.documentElement;switch(e){case"js":a=i.createElement("script"),a.async="async",a.charset="utf-8",a.type="text/javascript",a.onload=a.onreadystatechange=function(){a.readyState&&"loaded"!==a.readyState&&"complete"!==a.readyState||(a.onload=a.onreadystatechange=null,r&&a.parentNode&&r.removeChild(a))},a.src=t,r.appendChild(a);break;case"css":n=i.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=t,r.appendChild(n)}},hasClass:function(e,t){if(e.className)for(var i=e.className.split(" "),n=0,a=i.length;a>n;n++)if(t===i[n])return!0;return!1},isVisible:function(t){if(t==i)return!0;if(!t)return!1;if(!t.parentNode)return!1;if(t.style){if("none"==t.style.display)return!1;if("hidden"==t.style.visibility)return!1}var n=null;if(e.getComputedStyle){if(n=e.getComputedStyle(t,""),"none"==n.display)return!1;if("hidden"==n.visibility)return!1}if(n=t.currentStyle){if("none"==n.display)return!1;if("hidden"==n.visibility)return!1}return d.isVisible(t.parentNode)}},u=function(e,t){if(e.length)for(var i=0,n=e.length;n>i;i++)t.call(e[i],i);else e&&t.call(e,0)},f=function(e){u(e,function(){this.style.display="none"})},p=function(e,t){if(e)if("object"==typeof e)for(var i in e)t[i]=e[i];else"function"==typeof e&&(t[e]=e)},m=[],g=!1,v=/^(loaded|complete)$/,b=function(){if(!g){for(var e=0;m.length>e;e++)m[e]&&m[e].call(i);g=!0,m=null}},C=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",C,!1),b()):v.test(i.readyState)&&(i.detachEvent("onreadystatechange",C),b())},E=function(t){return"complete"===i.readyState?(b(),undefined):(m.push(t)>1||(i.addEventListener?(i.addEventListener("DOMContentLoaded",C,!1),e.addEventListener("loaded",b,!1)):i.attachEvent&&(i.attachEvent("onreadystatechange",C),e.attachEvent("onload",b))),undefined)},L={adsArray:[],requestAd:function(){for(var e=i.getElementsByTagName("img"),t=0,n=e.length;n>t;t++){var r=e[t];a[t]=r,r.insId=t,r.setAttribute("instreet_img_id",t),L.imgLoadHandle(r)}},imgLoadHandle:function(e){var t=new Image;t.src=e.src,t.insId=e.insId,t.complete?L.loadData(t):t.onload=function(){var e=this;e.onload=null,L.loadData(t)}},loadData:function(e){var t=e.insId,i=a[t];if(e.width>=c.imiw&&e.height>=c.imih&&(i.clientWidth>=c.imiw&&i.clientHeight>=c.imih||0===i.clientWidth&&0===i.clientHeight)){if("number"==typeof c.adsLimit&&0>=c.adsLimit)return;i.setAttribute("instreet_data_loading",!0),i.insDataLoading=!0,L.createJsonp(i),c.adsLimit&&c.adsLimit--}},createJsonp:function(e){var t=c.width||250,i=c.height||250,n=encodeURIComponent(encodeURIComponent(e.src)),a=c.callbackurl+"?index="+e.insId+"&pd="+c.widgetSid+"&iu="+n+"&callback=insjsonp"+"&w="+t+"&h="+i;d.importFile("js",a)}},T=function(e,t){this.data=t,this.img=a[t.index],this.param={width:c.width,height:c.height,initSrc:this.img.src,prevSrc:""},this.switchCount=0,this.init(e)};T.relocate=function(){for(var e in L.adsArray)L.adsArray[e]&&L.adsArray[e].locate()},p({init:function(e){this.createCouplet(e),this.fillContent(),this.locate(),this.bindEvent()},createCouplet:function(e){var t=this.param.width,n=this.param.height,a="display:none;position:fixed;_position:absolute;width:"+t+"px;height:"+n+"px;border:1px solid #ddd;background-color:#EEE;padding:2px;",r=i.createElement("div"),s=i.createElement("div");r.style.cssText=s.style.cssText=a,r.innerHTML=s.innerHTML='<a href="javascript:;" class="ins-btn-close" title="关闭" target="_self">×</a>',this.leftCouplet=r,this.rightCouplet=s,e.appendChild(r),e.appendChild(s)},fillContent:function(){var e=this.data,t=this.param.width,n=this.param.height;e={left:{src:"120600.swf",type:"flash"},right:{src:"120600.swf",type:"flash"}};var a=function(a){var r=i.createElement("div");switch(r.className="ins-couplet-cont",a.type){case"flash":r.innerHTML='<object width="'+t+'" height="'+n+'" align="middle" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"><param value="always" name="allowScriptAccess"/><param value="'+a.src+'" name="movie"/><param value="high" name="quality"/><param value="opaque" name="wmode"/><embed width="'+t+'" height="'+n+'" align="middle" pluginspage="http://www.adobe.com/go/getflashplayer" type="application/x-shockwave-flash" allowscriptaccess="always" wmode="opaque" quality="high" src="'+a.src+'"></embed></object>';break;case"image":r.innerHTML='<a href="#"><img width="'+t+'" height="'+n+'" src="'+e.src+'"/></a>'}return r};this.leftCouplet.appendChild(a(e.left)),this.rightCouplet.appendChild(a(e.right))},locate:function(){function e(){return gap>=w?(x=gap-w+"px",pageHeight>h&&(y=(pageHeight-h)/2+"px"),lC.closed||(lC.style.cssText+=";display:block;top:"+y+";left:"+x+";"),rC.closed||(rC.style.cssText+=";display:block;top:"+y+";right:"+x+";"),undefined):(f(lC),f(this.rightCouplet),undefined)}var t=o[c.widgetSid]||980;pageWidth=i.documentElement.clientWidth||i.body.offsetWidth,pageHeight=i.documentElement.clientHeight||i.body.offsetHeight,gap=(pageWidth-t)/2,lC=this.leftCouplet,rC=this.rightCouplet,w=this.param.width+6,h=this.param.height+6,x=0,y=0,clearTimeout(this.locateTimer),this.locateTimer=setTimeout(e,100)},bindEvent:function(){var e=this.leftCouplet,t=this.rightCouplet,i=d.$(e,"ins-btn-close")[0],n=d.$(t,"ins-btn-close")[0];i.onclick=function(){f(e),e.closed=!0},n.onclick=function(){f(t),t.closed=!0}},destroy:function(){var e=this.leftCouplet.parentNode;e&&e.removeChild(this.leftCouplet)&&e.removeChild(this.rightCouplet)},isImgChanged:function(){var e=this.img;return e.src&&e.src!=this.param.initSrc?(this.param.prevSrc=this.param.initSrc,this.param.initSrc=e.src,!0):!1}},T.prototype);var S=5,k=function(e){setInterval(function(){for(var t in e){var i=e[t];if(i&&i.isImgChanged()&&i.img.src!=i.param.prevSrc){var n=i.img;if(i.switchCount==S){i.destroy(),e[t]=null,c.adsLimit++,L.imgLoadHandle(n);break}i.switchCount++}}},100)};e.insjsonp=function(e){if(e){var t=e.index,i=a[t];i.insDataLoaded=!0,i.setAttribute("instreet_data_loaded",!0);var n=new T(r,e);L.adsArray[t]=n}},E(function(){t()})}})(window);