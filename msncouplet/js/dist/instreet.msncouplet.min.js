/*!2013-07-16 15:07:06 */
(function(e){function t(){"undefined"!=typeof instreet_config&&(p(instreet_config,c),c.width=120,c.height=600),(r=o())&&(c.cssurl&&d.importFile("css",c.cssurl),w.requestAd(),d.bind(e,"resize",function(){E.relocate()}),x(w.adsArray))}if(!e.InstreetWidget||"object"!=typeof e.InstreetWidget){e.InstreetWidget={version:"@REVISION@",type:"InstreetImageWidget",name:"msncouplet"};var i=e.document,n=(e.navigator,e.location),a=(n.hostname,!!e.ActiveXObject,[]),r=null,o=function(){var e=i.createElement("div"),t=i.getElementsByTagName("body")[0]||i.documentElement;return e.id=e.className="instreet-image-plugin-container",t&&t.firstChild?(t.insertBefore(e,t.firstChild),e):null},s={"746YRj7kfucKZSZc3KfGo0":980},l="http://push.instreet.cn/",c={redurl:l+"click.action",callbackurl:l+"push.action",murl:l+"tracker.action",iurl:l+"tracker90.action",ourl:l+"loadImage.action",surl:l+"share/weiboshare",imih:300,imiw:300,timer:1e3,width:120,height:600,adsLimit:1},d={bind:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},remove:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.datachEvent?e.datachEvent("on"+t,i):e["on"+t]=null},getEvent:function(t){return t?t:e.event},getTarget:function(e){return e.target||e.srcElement},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getRelatedTarget:function(e){return e.relatedTarget?e.relatedTarget:"mouseover"==e.type?e.fromElement:"mouseout"==e.type?e.toElement:null},getXY:function(e){var t=0,n=0;if(e.getBoundingClientRect){var a=e.getBoundingClientRect(),r=i.documentElement;t=a.left+Math.max(r.scrollLeft,i.body.scrollLeft)-r.clientLeft,n=a.top+Math.max(r.scrollTop,i.body.scrollTop)-r.clientTop}else for(;e!=i.body;t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent);return{x:t,y:n}},aTrim:function(e){function t(e,t){return e-t}var i=[];e.sort(t);for(var n=e.length,a=0,r=0;n>r;r++)e[r]!=e[r+1]&&(i[a]=e[r],a++);return i},$:function(e,t,n){var a,r=e||i;if(2==arguments.length?(n=t,a="*"):a=t||"*",i.getElementsByClassName)return r.getElementsByClassName(n);for(var o=[],s=r.getElementsByTagName(a),l=s.length,c=l;c--;){var d=s[c];if(d.className)for(var h=d.className.replace(/\s/g,"|").split("|"),u=h.length,p=u;p--;)if(h[p]==n){o.push(d);break}}return o},importFile:function(e,t){var n,a,r=i.getElementsByTagName("head")[0]||i.documentElement;switch(e){case"js":a=i.createElement("script"),a.async="async",a.charset="utf-8",a.type="text/javascript",a.onload=a.onreadystatechange=function(){a.readyState&&"loaded"!==a.readyState&&"complete"!==a.readyState||(a.onload=a.onreadystatechange=null,r&&a.parentNode&&r.removeChild(a))},a.src=t,r.appendChild(a);break;case"css":n=i.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=t,r.appendChild(n)}},hasClass:function(e,t){if(e.className)for(var i=e.className.split(" "),n=0,a=i.length;a>n;n++)if(t===i[n])return!0;return!1},isVisible:function(t){if(t==i)return!0;if(!t)return!1;if(!t.parentNode)return!1;if(t.style){if("none"==t.style.display)return!1;if("hidden"==t.style.visibility)return!1}var n=null;if(e.getComputedStyle){if(n=e.getComputedStyle(t,""),"none"==n.display)return!1;if("hidden"==n.visibility)return!1}if(n=t.currentStyle){if("none"==n.display)return!1;if("hidden"==n.visibility)return!1}return d.isVisible(t.parentNode)}},h=function(e,t){if(e)if(e.length)for(var i=0,n=e.length;n>i;i++)t.call(e[i],i);else e&&t.call(e,0)},u=function(e){h(e,function(){this.style.display="none"})},p=function(e,t){if(e)if("object"==typeof e)for(var i in e)t[i]=e[i];else"function"==typeof e&&(t[e]=e)},f=[],m=!1,g=/^(loaded|complete)$/,v=function(){if(!m){for(var e=0;f.length>e;e++)f[e]&&f[e].call(i);m=!0,f=null}},y=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",y,!1),v()):g.test(i.readyState)&&(i.detachEvent("onreadystatechange",y),v())},b=function(t){return"complete"===i.readyState?(v(),undefined):(f.push(t)>1||(i.addEventListener?(i.addEventListener("DOMContentLoaded",y,!1),e.addEventListener("loaded",v,!1)):i.attachEvent&&(i.attachEvent("onreadystatechange",y),e.attachEvent("onload",v))),undefined)},w={adsArray:[],requestAd:function(){for(var e=i.getElementsByTagName("img"),t=0,n=e.length;n>t;t++){var r=e[t];a[t]=r,r.insId=t,r.setAttribute("instreet_img_id",t),w.imgLoadHandle(r)}},imgLoadHandle:function(e){var t=new Image;t.src=e.src,t.insId=e.insId,t.complete?w.loadData(t):t.onload=function(){var e=this;e.onload=null,w.loadData(t)}},loadData:function(e){var t=e.insId,i=a[t];if(e.width>=c.imiw&&e.height>=c.imih&&(i.clientWidth>=c.imiw&&i.clientHeight>=c.imih||0===i.clientWidth&&0===i.clientHeight)){if("number"==typeof c.adsLimit&&0>=c.adsLimit)return;i.setAttribute("instreet_data_loading",!0),i.insDataLoading=!0,w.createJsonp(i),c.adsLimit&&c.adsLimit--}},createJsonp:function(e){var t=c.width||250,i=c.height||250,n=encodeURIComponent(encodeURIComponent(e.src)),a=c.callbackurl+"?index="+e.insId+"&pd="+c.widgetSid+"&iu="+n+"&callback=insjsonp"+"&w="+t+"&h="+i;d.importFile("js",a)}},E=function(e,t){this.data=t,this.img=a[t.index],this.param={width:c.width,height:c.height,initSrc:this.img.src,prevSrc:""},this.switchCount=0,this.init(e)};E.relocate=function(){for(var e in w.adsArray)w.adsArray[e]&&w.adsArray[e].locate()},p({init:function(e){this.createCouplet(e),this.fillContent(),this.locate(),this.bindEvent()},createCouplet:function(e){var t=this.param.width,n=this.param.height,a="display:none;position:fixed;_position:absolute;width:"+t+"px;height:"+n+"px;border:1px solid #ddd;background-color:#EEE;padding:2px;cursor:pointer;z-index:2147483647",r=i.createElement("div"),o=i.createElement("div");r.style.cssText=o.style.cssText=a,r.innerHTML=o.innerHTML='<a class="ins-btn-close" title="关闭" style="position:absolute;top:3px;right:3px;width:12px;height:12px;line-height:11px;border-radius:50%;background-color:#EEE;color:#888;text-align:center;cursor: pointer;text-decoration:none;z-index:19;">×</a>',this.leftCouplet=r,this.rightCouplet=o,e.appendChild(r),e.appendChild(o)},fillContent:function(){var e=this.data,t=this.param.width,n=this.param.height;e={left:{src:"http://s2.instreet.cn/corner/images/imgad01.gif",type:"image",directUrl:"http://www.instreet.cn"},right:{src:"http://s2.instreet.cn/corner/images/imgad02.gif",type:"image",directUrl:"http://www.instreet.cn"}};var a=function(e){var a=i.createElement("div");switch(a.style.position="relative",e.type){case"flash":a.innerHTML='<div><object width="'+t+'" height="'+n+'" align="middle" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"><param value="always" name="allowScriptAccess"/><param value="'+e.src+'" name="movie"/><param value="high" name="quality"/><param value="opaque" name="wmode"/><embed width="'+t+'" height="'+n+'" align="middle" pluginspage="http://www.adobe.com/go/getflashplayer" type="application/x-shockwave-flash" allowscriptaccess="always" wmode="opaque" quality="high" src="'+e.src+'"></embed></object></div>'+'<a href="'+e.directUrl+'" target="_blank" style="position:absolute;top:0;left:0;width:'+t+"px;height:"+n+'px;z-index:10;background-color:#FFF;opacity:0;filter:alpha(opacity=0)"></a>';break;case"image":a.innerHTML='<a target="_blank" title="" href="'+e.directUrl+'"><img width="'+t+'" height="'+n+'" src="'+e.src+'"/></a>'}return a};this.leftCouplet.appendChild(a(e.left)),this.rightCouplet.appendChild(a(e.right))},locate:function(){function e(){return l>=p?(m=l-p+"px",o>f&&(g=(o-f)/2+"px"),d.closed||(d.style.cssText+=";display:block;top:"+g+";left:"+m+";"),h.closed||(h.style.cssText+=";display:block;top:"+g+";right:"+m+";"),undefined):(u(d),u(h),undefined)}var t=s[c.widgetSid]||980,n=i.documentElement,a=i.body,r=n.clientWidth||a.clientWidth,o=n.clientHeight||a.clientHeight,l=(r-t)/2,d=this.leftCouplet,h=this.rightCouplet,p=this.param.width+6,f=this.param.height+6,m=0,g=0;clearTimeout(this.locateTimer),this.locateTimer=setTimeout(e,100)},bindEvent:function(){var e=this.leftCouplet,t=this.rightCouplet,i=d.$(e,"ins-btn-close")[0],n=d.$(t,"ins-btn-close")[0];i.onclick=function(){u(e),e.closed=!0},n.onclick=function(){u(t),t.closed=!0}},destroy:function(){var e=this.leftCouplet.parentNode;e&&e.removeChild(this.leftCouplet)&&e.removeChild(this.rightCouplet)},isImgChanged:function(){var e=this.img;return e.src&&e.src!=this.param.initSrc?(this.param.prevSrc=this.param.initSrc,this.param.initSrc=e.src,!0):!1}},E.prototype);var C=5,x=function(e){setInterval(function(){for(var t in e){var i=e[t];if(i&&i.isImgChanged()&&i.img.src!=i.param.prevSrc){var n=i.img;if(i.switchCount==C){i.destroy(),e[t]=null,c.adsLimit++,w.imgLoadHandle(n);break}i.switchCount++}}},100)};e.insjsonp=function(e){if(e){var t=e.index,i=a[t];i.insDataLoaded=!0,i.setAttribute("instreet_data_loaded",!0);var n=new E(r,e);w.adsArray[t]=n}},b(function(){t()})}})(window);